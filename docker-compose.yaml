version: "3.8"

services:
  app:
    container_name: "${PROJECT_NAME}"
    build:
      context: .
      dockerfile: Dockerfile
      args:
        CUDA_VERSION: ${CUDA_VERSION}
        BASE_IMAGE_TYPE: ${BASE_IMAGE_TYPE}
        OS_VERSION: ${OS_VERSION}
    image: ${PROJECT_NAME}:latest
    logging:
      driver: "json-file"
      options:
        tag: "{{.Name}}}"
    volumes:
      - ./app:/app
      - ./data:/data
      - ./logs:/logs
    ports:
      - "8888:8888"
    runtime: nvidia
    environment:
      - RUN_MODE=${RUN_MODE:-script}
    healthcheck:
      test: [ "CMD", "python3", "-c", "import sys; sys.exit(0)" ]
      interval: 30s
      timeout: 5s
      retries: 3
    stdin_open: true
    tty: true
